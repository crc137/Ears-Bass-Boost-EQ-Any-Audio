/*
✨ CoonDev • https://dev.coonlink.com/

 ▄█▄    ████▄ ████▄    ▄   ██▄   ▄███▄      ▄
 █▀ ▀▄  █   █ █   █     █  █  █  █▀   ▀      █
 █   ▀  █   █ █   █ ██   █ █   █ ██▄▄   █     █
 █▄  ▄▀ ▀████ ▀████ █ █  █ █  █  █▄   ▄▀ █    █
 ▀███▀              █  █ █ ███▀  ▀███▀    █  █
                    █   ██                 █▐
                                           ▐
*/

!function(){function e(e,t){q&&(q.textContent=e||"",q.className=t?"status error":"status")}function t(e){try{return JSON.parse(e)}catch(t){return null}}function n(){var e=localStorage.PRESETS||"{}";if(e.length>p)return{};var n=t(e);return n&&"object"==typeof n?n:{}}function r(){for(var e=[],n=0;d>n;n++){var r="filter"+n,o=localStorage[r],a=o?t(o):null,i=a&&"number"==typeof a.f?a.f:f[n],s=a&&"number"==typeof a.g?a.g:0,l=a&&"number"==typeof a.q?a.q:g[n],c=0===n?"lowshelf":n===d-1?"highshelf":"peaking";e.push({frequency:i,gain:s,q:l,type:c})}var u=1,p=localStorage.GAIN;if(p){var v=t(p);"number"==typeof v&&(u=v)}return{gain:u,filters:e}}function o(){return{format:"ears-preset-pack",version:1,createdAt:(new Date).toISOString(),presets:n(),current:r()}}function a(e,t){var n=new Blob([t],{type:"application/json"}),r=document.createElement("a");r.href=window.URL.createObjectURL(n),r.download=e,r.style.display="none",document.body.appendChild(r),r.click(),document.body.removeChild(r),setTimeout(function(){window.URL.revokeObjectURL(r.href)},1e3)}function i(e){chrome.runtime.sendMessage({type:"importPresets",presets:e})}function s(e){if(e&&e.filters&&e.filters.length){for(var t=0;t<e.filters.length;t++){var n=e.filters[t];n&&chrome.runtime.sendMessage({type:"modifyFilter",index:t,frequency:n.frequency,gain:n.gain,q:n.q})}"number"==typeof e.gain&&chrome.runtime.sendMessage({type:"modifyGain",gain:e.gain})}}function l(e){return e&&"object"==typeof e?"ears-preset-pack"===e.format?e:{presets:e}:null}function c(n,r){if(n.length>p)return e("File is too large.",!0);var o=t(n),a=l(o);return a?(a.presets&&"object"==typeof a.presets&&i(a.presets),r&&a.current&&s(a.current),void e("Import complete.")):e("Invalid preset file.",!0)}function u(n){if(n.length>p)return e("File is too large.",!0);var r=t(n);if(!r)return e("Invalid preset file.",!0);var o=l(r);return o&&o.current?(s(o.current),e("Current EQ applied.")):r&&r.filters?(s(r),e("Current EQ applied.")):void e("No current snapshot found in file.",!0)}var d=11,f=[20,40,80,160,320,640,1280,2560,5120,10240,20480],g=[.7071,.7071,.7071,.7071,.7071,.7071,.7071,.7071,.7071,.7071,.7071],p=2e6,v=document.getElementById("exportPackButton"),m=document.getElementById("importPackButton"),y=document.getElementById("importPackFile"),h=document.getElementById("exportCurrentButton"),S=document.getElementById("importCurrentButton"),b=document.getElementById("importCurrentFile"),w=document.getElementById("applyCurrentAfterImport"),q=document.getElementById("status");v&&(v.onclick=function(){var t,n=o();try{t=JSON.stringify(n,null,2)}catch(r){return e("Failed to serialize presets.",!0)}return t.length>p?e("Preset pack is too large.",!0):(a("EarsPresetPack.ears.json",t),void e("Preset pack exported."))}),m&&y&&(m.onclick=function(){y.value="",y.click()},y.onchange=function(){if(y.files&&y.files.length){var t=y.files[0];if(t.size>p)return e("File is too large.",!0);var n=new FileReader;n.onload=function(e){c(e.target.result,w&&w.checked)},n.onerror=function(){e("Failed to read file.",!0)},n.readAsText(t)}}),h&&(h.onclick=function(){var t,n=r();try{t=JSON.stringify({format:"ears-current",version:1,current:n},null,2)}catch(o){return e("Failed to serialize current EQ.",!0)}return t.length>p?e("Snapshot is too large.",!0):(a("EarsCurrentEQ.ears.json",t),void e("Current EQ exported."))}),S&&b&&(S.onclick=function(){b.value="",b.click()},b.onchange=function(){if(b.files&&b.files.length){var t=b.files[0];if(t.size>p)return e("File is too large.",!0);var n=new FileReader;n.onload=function(e){u(e.target.result)},n.onerror=function(){e("Failed to read file.",!0)},n.readAsText(t)}})}();